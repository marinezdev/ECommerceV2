
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Content/css/login/Style.css" rel="stylesheet" />

<p class="estetic">
    <br />
    <br />
    <br />
    <br />
</p>
<style>
    @@media (max-width: 991px) {
        .estetic {
            display: none;
        }
    }

    @@media (max-width: 833px) {
        .book {
            display: none;
        }

        .form-box {
            margin: auto;
        }

        .imglogo {
            width: 42% !important;
            margin: 10% !important;
            margin-left: 40% !important;
            display: block !important;
        }
    }

    @@media (max-width: 575px) {
        .book {
            display: none;
        }

        .form-box {
            margin: auto;
        }

        .imglogo {
            width: 16% !important;
            margin: 4% !important;
            margin-left: 40% !important;
            display: block !important;
        }
    }


    button.btn2 {
        width: 100%;
        height: 50px;
        margin: 0;
        padding: 0 20px;
        vertical-align: middle;
        background: #15436d;
        background: linear-gradient(to right, #ffffff, #ffffff);
        border: 0;
        font-family: 'Roboto', sans-serif;
        font-size: 16px;
        font-weight: 500;
        line-height: 50px;
        color: #4391cf;
        -moz-border-radius: 4px;
        -webkit-border-radius: 4px;
        border-radius: 8px;
        text-shadow: none;
        -moz-box-shadow: none;
        -webkit-box-shadow: none;
        box-shadow: none;
        -o-transition: all .3s;
        -moz-transition: all .3s;
        -webkit-transition: all .3s;
        -ms-transition: all .3s;
        transition: all .3s;
        border: 1px solid #d9d9d9;
    }

        button.btn2:hover {
            background: linear-gradient(to right, #20669d, #377bad);
            color: #ffffff;
            -o-transition: all .3s;
            -moz-transition: all .3s;
            -webkit-transition: all .3s;
            opacity: 0.6;
        }


    .form-top {
        overflow: hidden;
        padding: 0 25px 15px 25px;
        background: #9E9E9E;
        background: -webkit-linear-gradient(to right, #3a7bd5, #00d2ff);
        background: linear-gradient(to right, #77a4b5, #b1cc69);
        -moz-border-radius: 4px 4px 0 0;
        -webkit-border-radius: 4px 4px 0 0;
        border-radius: 4px 4px 0 0;
        text-align: left;
    }

    button.btn {
        width: 100%;
        height: 50px;
        margin: 0;
        padding: 0 20px;
        vertical-align: middle;
        background: #15436d;
        background: linear-gradient(to right, #78a4b8, #b0ce68);
        border: 0;
        font-family: 'Roboto', sans-serif;
        font-size: 16px;
        font-weight: 500;
        line-height: 50px;
        color: #fff;
        -moz-border-radius: 4px;
        -webkit-border-radius: 4px;
        border-radius: 8px;
        text-shadow: none;
        -moz-box-shadow: none;
        -webkit-box-shadow: none;
        box-shadow: none;
        -o-transition: all .3s;
        -moz-transition: all .3s;
        -webkit-transition: all .3s;
        -ms-transition: all .3s;
        transition: all .3s;
    }

    .icon-header-noti::after {
        content: attr(data-notify);
        font-family: "Proxima Nova",-apple-system,"Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;
        font-size: 12px;
        color: #fff;
        line-height: 15px;
        text-align: center;
        display: block;
        position: absolute;
        top: -7px;
        right: 0;
        min-width: 15px;
        height: 15px;
        padding: 0 3px;
        background-color: #b1cc69;
    }

    button.btn:focus {
        outline: 0;
        opacity: 0.6;
        background: #add066;
        color: #fff;
    }

    .form-top {
        overflow: hidden;
        padding: 0 25px 15px 25px;
        background: #9E9E9E;
        background: -webkit-linear-gradient(to right, #3a7bd5, #00d2ff);
        background: linear-gradient(to right, #77a4b5, #b1cc69);
        -moz-border-radius: 4px 4px 0 0;
        -webkit-border-radius: 14px 14px 0 0;
        border-radius: 14px 14px 0 0;
        text-align: left;
        box-shadow: 0 1px 20px 0 rgb(69 90 100 / 23%);
    }

    .form-bottom {
        padding: 25px 25px 30px 25px;
        background: #ffffff;
        border: 8px;
        border-color: #000000;
        -moz-border-radius: 0 0 4px 4px;
        -webkit-border-radius: 0 0 4px 4px;
        border-radius: 0 0 14px 14px;
        text-align: left;
        border: 1px solid #f0f5ea;
        box-shadow: 0 1px 20px 0 rgb(69 90 100 / 23%);
    }

    .form-control {
        display: block;
        width: 100%;
        padding: 0.4375rem 0.875rem;
        font-size: 0.9375rem;
        font-weight: 400;
        line-height: 1.8;
        color: #697a8d;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #d9dee3;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        border-radius: 0.375rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }
    input, textarea, label {
        display: block;
        outline: none;
        border: none;
        color: #5b5b5b;
    }
    .form-check-label {
        padding-left: 0.25rem;
        margin-bottom: 0;
        color: #676767;
    }

    .form-top-left h3 {
        margin-top: 0;
        color: #fff;
        font-weight: 600;
    }
    .text-danger {
        color: #ff0049 !important;
        font-weight: 500;
    }
    .btn.disabled, .btn:disabled {
        opacity: .65;
        background: linear-gradient(to right, #b1b1b1, #9d9d9d);
    }
</style>
<!-- Top content -->
<br />
<div class="top-content">

    <div class="inner-bg">
        <div class="container">
            <div class="row">
                <div class="Bienvenido col-sm-10   col-md-8 col-sm-offset-2 text">
                    <h1><strong>Bienvenido</strong> </h1>
                    <div class="description">
                        <p>
                            Crea una cuenta con nosotros, para realizar <strong> rastreos sobre tus compras realizadas</strong>.
                            <br />
                            Al inciar sesión estás aceptando los <a href="#"><strong>Términos y condiciones de Uso </strong></a>
                            <br />
                        </p>
                    </div>
                </div>
                <div class="col-sm-2 col-md-4">
                    <img src="~/images/icons/Logo_Csb.png" class="img-fluid imglogo" style="width:50%; margin:auto; display:none" />
                </div>
            </div>

            <div class="row">
                <div class="col-sm-6 book">
                    <img src="/images/icons/Logo_CsbHD.png" class="img-fluid" style="width:50%;padding-top: 16%;margin-left: 10%;">
                </div>
                <div class="col-md-5">
                    <div class="form-top">
                        <div class="form-top-left">
                            <h3>Iniciar sesión </h3>
                            <br />
                            <p>Complete el siguiente formulario para obtener acceso:</p>
                        </div>
                        <div class="form-top-right">
                            <i class="fa fa-user-circle-o" aria-hidden="true"></i>
                        </div>
                    </div>
                    <div class="form-bottom">
                        <form id="loginForm">
                            <div class="row">
                                <div class="form-group col-md-12">
                                    <label for="form-email">Correo electrónico:</label>
                                    <input type="email" name="form-email" placeholder="Email ... " class="form-control" id="email">
                                    <label id="MensajeText" class="text-danger" style="display: none;"> </label>
                                </div>
                                <div class="form-group col-md-12">
                                    <label for="form-last-name">Contraseña:</label>
                                    <input type="password" name="Password" placeholder="Password ..." class="form-last-name form-control" id="password" style="height: 40px;">
                                    <label id="MensajePasswordText" class="text-danger" style="display: none;"> </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-check col-sm-1">
                                </div>
                                <div class="form-check col-sm-11">
                                    <input type="checkbox" class="form-check-input" id="SesionCheck" name="SesionCheck">
                                    <label class="form-check-label" for="SesionCheck">
                                        Recordar contraseña
                                    </label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group col-md-12">
                                    <button type="submit" id="IniciarSesion" class="btn">Iniciar sesión</button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <p class="text-inverse text-center">
                                        <span><font style="vertical-align: inherit;"><font style="vertical-align: inherit; font-size:13px; margin-bottom:10px;"><strong>¿ Eres nuevo y en CSB E-Commerce ?</strong> </font></font></span>
                                    </p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <button type="button" id="CrearCuenta" class="btn2">Crea tu cuenta</button>
                                </div>
                            </div>
                            
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<br />
<br />
<br />
<div class="bg6 flex-c-m flex-w size-302 " style=" background: linear-gradient(to right, #78a4b8, #b0ce68);">
    <span class="stext-107 cl6 p-lr-25">
    </span>
    <span class="stext-107 cl6 p-lr-25">
    </span>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $('#CrearCuenta').click(function () {
        window.location.href = '@Url.Action("TerminosCondiciones", "Registro")';
    });

    $(document).ready(function() {
        // Asociar evento 'submit' al formulario con el id "loginForm"
        $("#loginForm").on("submit", function (event) {

            $('#IniciarSesion').prop('disabled', true);

            event.preventDefault(); // Prevenir el envío del formulario por defecto

            if (validateFrom()) {

                var Session = false;
                if ($('input:checkbox[name=SesionCheck]:checked').val()) {
                    Session = true;
                }

                var Rol = new Object();
                Rol.Ruta = '@ViewBag.rd';
                Rol.RutaAcceso = '@ViewBag.rdv';

                var Usuario = new Object();
                Usuario.Rol = Rol;
                Usuario.usuario = $("#email").val();
                Usuario.Password = $("#password").val();
                Usuario.Session = Session;

                $.ajax({
                    url: "@Url.Action("IniciarSesion", "Adm")",
                    type: "POST",
                    data: JSON.stringify(Usuario),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    error: function () {
                        $('#IniciarSesion').prop('disabled', false);
                        swal({
                            title: "Algo ocurrió !",
                            text: "Ha ocurrido un problema, inténtalo mas tarde ",
                            icon: "warning",
                            button: "Aceptar",
                        });
                    },
                    success: function (response) {
                        if (response.Id > 0) {
                            swal({
                                title: "Bienvenido. !",
                                text: response.Persona.Nombre + " " + response.Persona.ApellidoPaterno + " " + response.Persona.ApellidoMaterno,
                                icon: "success",
                                button: "Aceptar",
                            }).then((value) => {
                                window.location.href = '' + response.Rol.RutaAcceso + '';
                            });
                        } else {
                            $('#IniciarSesion').prop('disabled', false);
                            swal({
                                title: "Algo ocurrió !",
                                text: response.Mensaje,
                                icon: "warning",
                                button: "Aceptar",
                            });
                        }
                    }
                });


            } else {
                $('#IniciarSesion').prop('disabled', false);
            }
        });

        function validateFrom() {
            var result = false;

            $("#MensajeText").css("display", "none");
            $("#MensajePasswordText").css("display", "none");
            $('#email').css("border", "1px solid #d9dee3");
            $('#password').css("border", "1px solid #d9dee3");

            // Obtener los valores del correo electrónico y contraseña
            var email = $("#email").val();
            var password = $("#password").val();

            // Validar el formulario
            if (!validateEmail(email)) {
                $('#email').css("border", "2px solid #ff0049");
                $('#MensajeText').html("Por favor, ingresa un correo electrónico válido.");
                $("#MensajeText").show();
            }

            if (password.length < 8) {
                $('#password').css("border", "2px solid #ff0049");
                $('#MensajePasswordText').html("La contraseña debe tener al menos 8 caracteres.");
                $("#MensajePasswordText").show();
            }

            if (validateEmail(email)) {
                if (password.length >= 8) {
                    result = true;
                }
            }
            return result;
        }

        // Función para validar el formato del correo electrónico utilizando una expresión regular
        function validateEmail(email) {
          var emailRegex = /^[^\s@@]+@@[^\s@@]+\.[^\s@@]+$/;
          return emailRegex.test(email);
        }
    });

</script>
