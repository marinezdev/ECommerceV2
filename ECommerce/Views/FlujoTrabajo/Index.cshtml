
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout_Administracion.cshtml";
}

<link rel="stylesheet" type="text/css" href="~/assets/icon/icofont/css/icofont.css">
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css" />

<!-- Modal Nueva Etapa -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Nueva Etapa </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Completa los campos marcados *</p>
                <div class="col-md-12 col-lg-12">
                    <div class="form-group">
                        <label for="largeInput">* Nombre </label>
                        <input type="text" class="form-control form-control" id="NombreEtapaModal" placeholder="" autocomplete="off" onchange="ValidaInput('NombreEtapaModal')">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn waves-effect waves-light btn-success" id="BtnGuardarNuevaEtapa"><i class="icofont icofont-save"></i> Guardar </button>
                <button class="btn waves-effect waves-light btn-inverse" id="BtnCerrarNuevaEtapa" data-dismiss="modal"><i class="icofont icofont-exit"></i> Cancelar </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Nuevo usuario -->
<div class="modal fade" id="ModalUsuarios" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Agregar usario a etapa </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class='card-block table-border-style' id="TableUsuariosList">
                </div>
                @*<p>Completa los campos marcados *</p>
                    <div class="col-md-12 col-lg-12">
                        <div class="form-group">
                            <label for="largeInput">* Nombre </label>
                            <input type="text" class="form-control form-control" id="NombreEtapaModal" placeholder="" autocomplete="off" onchange="ValidaInput('NombreEtapaModal')">
                        </div>
                    </div>*@
            </div>
            <div class="modal-footer">
                <button class="btn waves-effect waves-light btn-inverse" id="BtnCerrarNuevaEtapa" data-dismiss="modal"><i class="icofont icofont-exit"></i> Cerrar  </button>
            </div>
        </div>
    </div>
</div>

<div class="pcoded-content">
    <!-- Page-header start -->
    <div class="page-header">
        <div class="page-block">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="page-header-title">
                        <h5 class="m-b-10">Nuevo Flujo </h5>
                        <p class="m-b-0">Ecommerce San Juan </p>
                    </div>
                </div>
                <div class="col-md-4">
                    <ul class="breadcrumb-title">
                        <li class="breadcrumb-item">
                            <a href="index.html"> <i class="fa fa-home"></i> </a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="#!">Flujo de trabajo </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- Page-header end -->
    <div class="pcoded-inner-content">
        <!-- Main-body start -->
        <div class="main-body">
            <div class="page-wrapper">
                <!-- Page-body start -->
                <div class="page-body">

                    <div class="row">
                        <div class="col-sm-12">
                            <!-- Basic Form Inputs card start -->
                            <div class="card">
                                <div class="card-header">
                                    <h5>Nuevo Flujo  </h5>
                                    <span>Completa los campos marcados *</span>
                                    <span>Creación de nuevo flujo de trabajo, escribe un nombre al proceso y enseguida podrás agregar las etapas que requieras, además de agregar a los usuarios involucrados en cada etapa de tu proceso.</span>
                                </div>
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-md-5 col-lg-5">
                                            <div class="col-md-12 col-lg-12">
                                                <div class="form-group">
                                                    <label for="largeInput">* Nombre Flujo  </label>
                                                    <input type="text" class="form-control form-control input-number" id="NombreFlujo" onchange="ValidaInput('NombreFlujo')">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 col-lg-4">
                                            <br />
                                            <button class="btn waves-effect waves-light btn-primary col-sm-12" id="BtnCrearFlujo"><i class="icofont icofont-ui-add"></i> Crear Flujo  </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row" id="DivMesasUsuarios" style="display: none;">

                        <div class="col-sm-8">
                            <!-- Basic Form Inputs card start -->
                            <div class="card" id="CardMesas">
                                <div class="card-header">
                                    <h5> Etapas Flujo: <span id="TituloFlujo"></span> </h5>
                                    <span>Se muestra un flujo base, puedes agregar o quietar etapas dentro de tu proceso.</span>
                                </div>
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-md-4 col-lg-4">
                                            <button class="btn waves-effect waves-light btn-primary col-sm-12" data-toggle="modal" data-target="#exampleModal"><i class="icofont icofont-ui-add"></i> Agregar Etapa  </button>
                                        </div>
                                    </div>
                                    <div class='card-block table-border-style' id="TableMesas">
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4 col-lg-4">
                                            <button class="btn waves-effect waves-light btn-primary col-sm-12" id="BtnRegistrarEtapasUsuarios"><i class="icofont icofont-save"></i> Guardar etapas  </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-4">
                            <!-- Basic Form Inputs card start -->
                            <div class="card" id="CardUsuarios" style="display: none;">
                                <div class="card-header">
                                    <h5> Usuarios Etapa: <span id="TituloEtapa"></span></h5>
                                    <span>Agregar o quitar usuarios a la etapa</span>
                                </div>
                                <div class="card-block" id="UsuariosEtapaForm">

                                </div>
                            </div>
                        </div>


                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="~/assets/js/bootstrap-notify/bootstrap-notify.min.js"></script>
<script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>


<script>
    $('#IdMenuFlujo').addClass("active pcoded-trigger");
    $('#IdMenuFlujoNuevo').addClass("active");


    $('#BtnRegistrarEtapasUsuarios').click(function () {
        swal({
            title: "¡Confirmación! ",
            text: "¿ Registrar etapas a flujo: " + $('#NombreFlujo').val() + " ?",
            icon: "warning",
            buttons: true,
            /*dangerMode: true,*/
            buttons: ["Cancelar", "Registrar"],
        })
        .then((willDelete) => {
            if (willDelete) {
                RegistrarEtapasUsuarios();
            }
        });
    });

    function RegistrarEtapasUsuarios() {
        $.ajax({
            type: "POST",
            url: "@Url.Action("EtapaUsuarios_Registrar", "FlujoTrabajo")",
            async: false,
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {
                switch (response) {
                    case -1:
                        swal({
                            title: "Etapa sin usuarios !",
                            text: "Registra algún usuario sobre una etapa ",
                            icon: "warning",
                            button: "Aceptar",
                        });
                        break;
                    case 0:
                        swal({
                            title: "Flujo sin etapas !",
                            text: "Registra alguna etapa",
                            icon: "warning",
                            button: "Aceptar",
                        });

                        break;
                    case 1:
                        swal({
                            title: "Registro exitoso. !",
                            text: "Etapas y usuarios registrados ",
                            icon: "success",
                            button: "Aceptar",
                        }).then((value) => {
                            location.reload();
                            /*window.location.href = '' + response.RutaAcceso + '';*/
                        });
                        break;
                    default:
                    // code block

                }
            },
            error: errores
        });
    }



    $('#BtnGuardarNuevaEtapa').click(function () {
        if (ValidarModalCategoria()) {
            var obj = {};
            obj['Nombre'] = $('#NombreEtapaModal').val();

            var jsonObject = {
                "cat_FlujoBase": obj
            };

            $.ajax({
                type: "POST",
                url: "@Url.Action("Etapa_Agregar", "FlujoTrabajo")",
                async: false,
                data: JSON.stringify(jsonObject),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: resultadoNuevaEtapa,
                error: errores
            });
        } else {
            $.notify({
                message: "Formulario incompleto!."
            }, {
                type: 'danger'
            });
        }
    });

    function resultadoNuevaEtapa(data) {

        if (data.length > 0) {

            $('#TableMesas').html(PintaTablaEtapas(data));

        } else {
            $.notify({
                message: "La nueva etapa que intentas agregar ya se encuentra registrada."
            }, {
                type: 'danger',
                allow_dismiss: false,
                animate: {
                    enter: 'animated rollIn',
                    exit: 'animated rollOut'
                }
            });
        }

        $('#NombreEtapaModal').val("");
        $("#BtnCerrarNuevaEtapa").trigger("click");
    }

    function ValidarModalCategoria() {
        var respuesta = false;
        $('#NombreEtapaModal').css("border", "1px solid #f44336");

        if ($('#NombreEtapaModal').val().length > 0) {
            $('#NombreEtapaModal').css("border", "1px solid #cccccc");
        }

        if ($('#NombreEtapaModal').val().length > 0) {
            respuesta = true;
        }
        return respuesta;
    }


    $('#BtnCrearFlujo').click(function () {
        if (ValidarNuevoFlujo()) {

            var obj = {};
            obj['Nombre'] = $('#NombreFlujo').val();

            var jsonObject = {
                "Flujo": obj
            };

            $.ajax({
                type: "POST",
                url: "@Url.Action("Flujo_Agregar", "FlujoTrabajo")",
                async: false,
                data: JSON.stringify(jsonObject),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: SuccessFlujoAgregar,
                error: errores
            });

        } else {
            $.notify({
                message: "Formulario incompleto!."
            }, {
                type: 'danger'
            });
        }
    });

    function SuccessFlujoAgregar(data) {

        switch (data.Id) {
            case -1:
                $.notify({
                    message: "El nuevo nombre del flujo que intentas agregar ya se encuentra registrado ."
                }, {
                    type: 'danger',
                    allow_dismiss: false,
                    animate: {
                        enter: 'animated rollIn',
                        exit: 'animated rollOut'
                    }
                });
                $('#NombreFlujo').css("border", "1px solid #f44336");
                break;
            case 0:
                swal({
                    title: "Algo ocurrió !",
                    text: '',
                    icon: "warning",
                    button: "Aceptar",
                });
                break;

            default:
            // code block
        }

        if (data.Id > 0) {
            $.notify({
                message: "¡Nuevo flujo agregado!."
            }, {
                type: 'success',
                allow_dismiss: false,
                animate: {
                    enter: 'animated rollIn',
                    exit: 'animated rollOut'
                }
            });

            $("#BtnCrearFlujo").attr("disabled", true);
            $("#NombreFlujo").attr("disabled", true);

            MesasFlujo(data.Id);
        }
    }

    function MesasFlujo(num) {
        var obj = {};
        obj['Id'] = num;

        var jsonObject = {
            "Flujo": obj
        };

        $.ajax({
            type: "POST",
            url: "@Url.Action("Cat_FlujoBase_Listar", "FlujoTrabajo")",
            async: false,
            data: JSON.stringify(jsonObject),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: resultadoFlujoBase,
            error: errores
        });
    }

    function resultadoFlujoBase(data)
    {
        $("#DivMesasUsuarios").show();
        $("#TituloFlujo").text($('#NombreFlujo').val());
        $('#TableMesas').html("");

        /*PintaTablaEtapas(data);*/
        $('#TableMesas').html(PintaTablaEtapas(data));

        $("#CardUsuarios").css("display", "none");
        $('#TableUsuarios').html("");
        //$('#CardMesas').html("");
        //$('#CardUsuarios').html("");

    }

    function PintaTablaEtapas(data) {

        var Tabla =
        "<div class='table-responsive'>" +
            "<table class='table'>" +
                "<thead>" +
                    "<tr class='table-inverse'>" +
                        "<th>Nombre </th>" +
                        "<th>Etapa</th>" +
                        "<th></th>" +
                    "</tr>" +
                "</thead>" +
                "<tbody>";

                if (data.length > 0) {
                    var flag = 0;
                    var total = data.length;
                    for (var b = 0; b < data.length; b++) {
                        if (flag == 0) {
                        Tabla +=
                            "<tr>" +
                                "<td><label Id='Etapa_" + data[b].Id+"'>" +  data[b].Nombre + "</label></td>" +
                                "<td>" +  data[b].Etapa + "</td>" +
                                "<td>" +
                                    "<button class='btn waves-effect waves-dark btn-info btn-outline-info btn-icon' onclick='ConsultaUsuarios(" +  data[b].Id + ")'><i class='icofont icofont-user-alt-3'></i></button>" +
                                    "<button class='btn waves-effect waves-dark btn-danger btn-outline-danger btn-icon' onclick='EliminarEtapa(" +  data[b].Id + ")'><i class='icofont icofont-trash'></i></button>" +
                                    "<button class='btn waves-effect waves-dark btn-inverse btn-outline-inverse btn-icon' onclick='BajarEtapa(" +  data[b].Id + ")'><i class='icofont icofont-caret-down'></i></button>" +
                                "</td>" +
                            "</tr>";
                            flag = 1;
                        } else {
                            if ((total-1) == b) {
                                Tabla +=
                                "<tr>" +
                                    "<td><label Id='Etapa_" + data[b].Id+"'>" +  data[b].Nombre + "</label></td>" +
                                    "<td>" +  data[b].Etapa + "</td>" +
                                    "<td>" +
                                         "<button class='btn waves-effect waves-dark btn-info btn-outline-info btn-icon' onclick='ConsultaUsuarios(" +  data[b].Id + ")'><i class='icofont icofont-user-alt-3'></i></button>" +
                                         "<button class='btn waves-effect waves-dark btn-danger btn-outline-danger btn-icon' onclick='EliminarEtapa(" +  data[b].Id + ")'><i class='icofont icofont-trash'></i></button>" +
                                         "<button class='btn waves-effect waves-dark btn-inverse btn-outline-inverse btn-icon' onclick='SubirEtapa(" +  data[b].Id + ")'><i class='icofont icofont-caret-up'></i></button>" +
                                    "</td>" +
                                "</tr>";
                            } else {
                                Tabla +=
                                "<tr>" +
                                    "<td><label Id='Etapa_" + data[b].Id+"'>" +  data[b].Nombre + "</label></td>" +
                                    "<td>" +  data[b].Etapa + "</td>" +
                                    "<td>" +
                                         "<button class='btn waves-effect waves-dark btn-info btn-outline-info btn-icon' onclick='ConsultaUsuarios(" +  data[b].Id + ")'><i class='icofont icofont-user-alt-3'></i></button>" +
                                         "<button class='btn waves-effect waves-dark btn-danger btn-outline-danger btn-icon' onclick='EliminarEtapa(" +  data[b].Id + ")'><i class='icofont icofont-trash'></i></button>" +
                                         "<button class='btn waves-effect waves-dark btn-inverse btn-outline-inverse btn-icon' onclick='SubirEtapa(" +  data[b].Id + ")'><i class='icofont icofont-caret-up'></i></button>" +
                                         "<button class='btn waves-effect waves-dark btn-inverse btn-outline-inverse btn-icon' onclick='BajarEtapa(" +  data[b].Id + ")'><i class='icofont icofont-caret-down'></i></button>" +
                                    "</td>" +
                                "</tr>";
                            }

                        }
                    }
                } else {
                    Tabla +=
                        "<tr>" +
                            "<td colspan='4'> Sin mesas de atención </td>" +
                        "</tr>";
                }

        Tabla +=
                "</tbody>" +
            "</table>" +
        "</div>";

        return Tabla;
    }

    function EliminarEtapa(Id) {
        var obj = {};
        obj['Id'] = Id;

        var jsonObject = {
            "cat_FlujoBase": obj
        };

        $.ajax({
            type: "POST",
            url: "@Url.Action("Etapa_Eliminar", "FlujoTrabajo")",
            async: false,
            data: JSON.stringify(jsonObject),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: resultadoEliminarEtapa,
            error: errores
        });
    }

    function SubirEtapa(Id) {
        var obj = {};
        obj['Id'] = Id;

        var jsonObject = {
            "cat_FlujoBase": obj
        };

        $.ajax({
            type: "POST",
            url: "@Url.Action("Etapa_Subir", "FlujoTrabajo")",
            async: false,
            data: JSON.stringify(jsonObject),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: resultadoEliminarEtapa,
            error: errores
        });
    }

    function BajarEtapa(Id) {
        var obj = {};
        obj['Id'] = Id;

        var jsonObject = {
            "cat_FlujoBase": obj
        };

        $.ajax({
            type: "POST",
            url: "@Url.Action("Etapa_Bajar", "FlujoTrabajo")",
            async: false,
            data: JSON.stringify(jsonObject),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: resultadoEliminarEtapa,
            error: errores
        });
    }

    function resultadoEliminarEtapa(data) {
        $('#TableMesas').html(PintaTablaEtapas(data));
        $("#CardUsuarios").css("display", "none");
    }

    function ConsultaUsuarios(Id) {
        $('#UsuariosEtapaForm').html("");
        $("#TituloEtapa").text($('#Etapa_' + Id).text());

        var form =
         "<div class='row'>" +
            "<div class='col-md-12 col-lg-12'>" +
                "<button class='btn waves-effect waves-light btn-primary col-sm-12' onclick='AgregarUsuario(" + Id + ")'><i class='icofont icofont-ui-add'></i> Agregar usuario  </button>" +
            "</div>" +
        "</div>" +
        "<div class='card-block table-border-style' id='TableUsuarios'>" +

        "</div>";

        $('#UsuariosEtapaForm').html(form);

        var obj = {};
        obj['Etapa'] = Id;

        var jsonObject = {
            "Cat_FlujoBase": obj
        };

        $.ajax({
            type: "POST",
            url: "@Url.Action("EtapaUsuarios", "FlujoTrabajo")",
            async: false,
            data: JSON.stringify(jsonObject),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: SuccessEtapaUsuarios,
            error: errores
        });
    }

    function SuccessEtapaUsuarios(data) {
        console.log(data);

        $("#CardUsuarios").show();
        $('#TableUsuarios').html("");

        var Tabla =
        "<div class='table-responsive'>" +
            "<table class='table'>" +
                "<thead>" +
                    "<tr class='table-inverse'>" +
                        "<th>Usuario </th>" +
                        "<th></th>" +
                    "</tr>" +
                "</thead>" +
                "<tbody>";

                if (data.length > 0) {
                    for (var b = 0; b < data.length; b++) {
                    Tabla +=
                        "<tr>" +
                            "<td>" + data[b].Usuario +  "</td>" +
                            "<td>" +
                                "<button class='btn waves-effect waves-dark btn-danger btn-outline-danger btn-icon' onclick='EliminarUsuario(" + data[b].IdUsuario + "," + data[b].Etapa + ")'><i class='icofont icofont-trash'></i></button>" +
                            "</td>" +
                        "</tr>";
                    }
                } else {
                    Tabla +=
                    "<tr>" +
                        "<td colspan='2'> Sin usuarios </td>" +
                    "</tr>";
                }


       Tabla +="</tbody>" +
            "</table>" +
        "</div>";

        $('#TableUsuarios').html(Tabla);
    }

    function AgregarUsuario(Id) {
        $("#ModalUsuarios").modal("show");

        var obj = {};
        obj['IdEtapa'] = Id;

        var jsonObject = {
            "EtapasUsuario": obj
        };

        $.ajax({
            type: "POST",
            url: "@Url.Action("Usuarios_listar_Asignacion", "FlujoTrabajo")",
            async: false,
            data: JSON.stringify(jsonObject),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: SuccessListaEtapaUsuarios,
            error: errores
        });
    }

    function SuccessListaEtapaUsuarios(data) {
        $('#TableUsuariosList').html("");

         var Tabla =
        "<div class='table-responsive'>" +
             "<table class='table text-center' Id='TableListUsuarioEtapasAgregar' style='width:100%'>" +
                "<thead>" +
                    "<tr class='table-inverse'>" +
                        "<th class='text-center'>Usuario</th>" +
                        "<th class='text-center'>Agregar</th>" +
                    "</tr>" +
                "</thead>" +
                "<tbody>";

                if (data.length > 0) {
                    for (var b = 0; b < data.length; b++) {
                    Tabla +=
                        "<tr>" +
                            "<td>" + data[b].NombreUsuario +  "<br>" + data[b].Correo + "</td>" +
                            "<td>" +
                                "<button class='btn waves-effect waves-dark btn-success btn-outline-success btn-icon' onclick='AgregarUsuarioEtapa(" + data[b].Id + "," + data[b].IdEtapa +")'><i class='icofont icofont-check-circled'></i></button>" +
                            "</td>" +
                        "</tr>";
                    }
                } else {
                    Tabla +=
                    "<tr>" +
                        "<td colspan='2'> Sin usuarios </td>" +
                    "</tr>";
                }


       Tabla +="</tbody>" +
            "</table>" +
            "</div>";

        $('#TableUsuariosList').html(Tabla);

        $('#TableListUsuarioEtapasAgregar').DataTable({
            "language": {
                "url": "//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json"
            },
            "scrollY": "500px",
            "scrollCollapse": true,
        });


    }

    function AgregarUsuarioEtapa(user, etapa) {

        var obj = {};
        obj['IdEtapa'] = etapa;
        obj['IdUsuario'] = user;

        var jsonObject = {
            "EtapasUsuario": obj
        };

        $.ajax({
            type: "POST",
            url: "@Url.Action("EtapaUsuarios_Existencia", "FlujoTrabajo")",
            async: false,
            data: JSON.stringify(jsonObject),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {
                if (!response) {
                    var obj2 = {};
                    obj2['IdEtapa'] = etapa;
                    obj2['IdUsuario'] = user;

                    var jsonObject2 = {
                        "EtapasUsuario": obj2
                    };

                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("EtapaUsuarios_Agregar", "FlujoTrabajo")",
                        async: false,
                        data: JSON.stringify(jsonObject2),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: SuccessEtapaUsuarios,
                        error: errores
                    });
                } else {
                    $.notify({
                        message: "El usuario que intentas agregar ya se encuentra registrado en esa etapa."
                    }, {
                        type: 'danger',
                        allow_dismiss: false,
                        animate: {
                            enter: 'animated rollIn',
                            exit: 'animated rollOut'
                        }
                    });
                }

            },
            error: errores
        });

    }

    function EliminarUsuario(user, etapa) {
        var obj = {};
        obj['IdEtapa'] = etapa;
        obj['IdUsuario'] = user;

        var jsonObject = {
            "EtapasUsuario": obj
        };

        $.ajax({
            type: "POST",
            url: "@Url.Action("EtapaUsuarios_Eliminar", "FlujoTrabajo")",
            async: false,
            data: JSON.stringify(jsonObject),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: SuccessEtapaUsuarios,
            error: errores
        });
    }

    function errores() {
        $.notify({
            message: "Inténtelo mas tarde."
        }, {
            type: 'danger',
            allow_dismiss: false,
            animate: {
                enter: 'animated rollIn',
                exit: 'animated rollOut'
            }
        });
    }

    function ValidarNuevoFlujo() {
        var respuesta = false;
        $('#NombreFlujo').css("border", "1px solid #f44336");

        if ($('#NombreFlujo').val().length > 0) {
            $('#NombreFlujo').css("border", "1px solid #cccccc");
        }

        if ($('#NombreFlujo').val().length > 0) {
            respuesta = true;
        }
        return respuesta;
    }

    function ValidaInput(name) {
        if ($('#' + name).val().length > 0) {
            $('#' + name).css("border", "1px solid rgb(222 222 222)");
        } else {
            $('#' + name).css("border", "1px solid #ff0049");
        }
    }

    function ValidaSelect(name) {
        if ($('#' + name + ' option:selected').val() > 0) {
            $('#' + name).css("border", "1px solid rgb(222 222 222)");
        } else {
            $('#' + name).css("border", "1px solid #ff0049");
        }
    }

</script>